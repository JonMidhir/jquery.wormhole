(function($){$.fn.isWormHole=function(options){this.each(function(){var defaults={group:'default',selector:'*',stop:function(){}};var options=$.extend(defaults,options);var $thisObject=$(this);$thisObject.css('overflow','hidden');if($thisObject.css('position')=="static"){$thisObject.css('position','relative');}
$thisObject.find(options.selector).each(function(){$(this).css('position','absolute');});$thisObject.data('wormGroup',options.group);$thisObject.addClass('wormgroup-'+options.group);$thisObject.delegate(options.selector,'mouseover',function(){if($(this).data('isWorm')!=true&&$(this).data('isClone')!=true){var containmentCoords=[$thisObject.offset().left,$thisObject.offset().top-$thisObject.height(),$thisObject.offset().left+$thisObject.width()-$(this).width(),$thisObject.offset().top+($thisObject.height()*2)];$(this).draggable("option","containment",containmentCoords);$(this).draggable("option","stack",options.selector);$(this).isWorm(options.group,$thisObject,options.stop);}});});};$.fn.isWorm=function(group,parent,stopCallback){if(this.data('isWorm')!=true){var $nextWormHole=parent.next('.wormgroup-'+group);var $prevWormHole=parent.prev('.wormgroup-'+group);var $cloneWorm=this.clone(true);$cloneWorm.data('isClone',true);$(this).data('isWorm',true);var errorBars=$(this).height()/2;this.bind("drag",function(event,ui){if($(this).position().top+$(this).height()>parent.height()&&$nextWormHole.length>0){var newHeight=$(this).position().top-parent.height();$cloneWorm.css('left',$(this).css('left')).css('opacity',$(this).css('opacity')).css('top',newHeight+"px");$nextWormHole.append($cloneWorm);}else if($(this).position().top<0&&$prevWormHole.length>0){var newHeight=$(this).position().top+parent.height();$cloneWorm.css('left',$(this).css('left')).css('opacity',$(this).css('opacity')).css('top',newHeight+"px");$prevWormHole.append($cloneWorm);}});this.bind("dragstop",function(event,ui){if($(this).position().top>parent.height()){var draggableOptions=$(this).data("draggable").options;$(this).css('top',$cloneWorm.position().top+'px');$cloneWorm.replaceWith($(this));delete $cloneWorm;stopCallback;$(this).unbind('drag').unbind('dragstop');$(this).draggable(draggableOptions);$(this).data('isWorm',false);}else if($(this).position().top+$(this).height()>parent.height()){var newHeight=$(this).position().top-parent.height();$cloneWorm.css('left',$(this).css('left')).css('opacity',$(this).css('opacity')).css('top',newHeight+"px");}else if($(this).position().top<=(0-$(this).height())){var draggableOptions=$(this).data("draggable").options;$(this).css('top',$cloneWorm.position().top+'px');$cloneWorm.replaceWith($(this));delete $cloneWorm;stopCallback;$(this).unbind('drag').unbind('dragstop');$(this).draggable(draggableOptions);$(this).data('isWorm',false);}else if($(this).position().top<0){var newHeight=$(this).position().top+parent.height();$cloneWorm.css('left',$(this).css('left')).css('opacity',$(this).css('opacity')).css('top',newHeight+"px");}else{$cloneWorm.detach();}});}};})(jQuery);